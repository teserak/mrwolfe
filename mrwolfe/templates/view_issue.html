{% extends "base.html" %}

{% block tools %}
<div id="tools" class="btn-toolbar">

  {% include "controls/status_control.html" %}
  {% include "controls/assignee_control.html" %}
  <a href="{% url 'edit_issue' object.pk %}" class="btn">
    <i class="icon-edit"></i> Edit
  </a>
  {% if issue.can_clone %}
  <a href="{% url 'clone_issue' object.pk %}" class="btn action-inline"
     data-pu_actionmethod="POST" data-pu_protect="true">
    <i class="icon-copy"></i> Clone
  </a>
  {% endif %}
  <a href="{% url 'create_comment_json' object.pk %}" class="btn add-inline"
     target="#comments">
    <i class="icon-comment"></i> Add comment
  </a>  
</div>
{% endblock %}

{% block content %}

<h2>
  <span class="label label-{{ issue.urgency }}">{{ issue.urgency }}</span>
  {{ object.issue_id }} {{ object.title }}
</h2>

<dl>
  {% if object.sla %}
  <dt>SLA</dt>
  <dd><a href="{% url 'view_sla' object.sla.pk %}">{{ object.sla }}</a></dd>
  {% endif %}
  <dt>Service</dt><dd>{{ object.service }}</dd>
  <dt>Created</dt><dd>{{ object.created }}</dd>
  {% if not object.dateclosed %}
  <dt>Deadline</dt><dd>{{ object.deadline|default:"-" }}</dd>
  <dt>Time to resolve</dt><dd>{{ object.time_to_resolve|default:"-" }}</dd>
  {% else %}
  <dt>Closed</dt><dd>{{ object.dateclosed|default:"-" }}</dd>
  {% endif %}
  <dt>Contact</dt><dd>{{ object.contact }}</dd>
</dl>

<div class="viewlet well">
  <h2>Description</h2>
  {{ view.text|safe }}
</div>

<div class="viewlet well">
  <header class="clearfix">
    <h2 class="pull-left">Attachments</h2>
    <div class="btn fileinput-button">
      <i class="icon-file"></i> Add attachment(s)
      <input type="file"
             mutiple="multiple"
             name="attachment_upload"
             data-progress="#progress_attachment"
             data-issueid="{{ object.id }}"
             data-target="#attachments" />
    </div>  
  </header>

  <div id="progress_attachment" 
     class="progress progress-info hide">
    <div class="bar"></div>
  </div>

  <ul id="attachments">
    {% for attachment in object.attachment_set.all %}
    {% include "snippets/attachment.html" with object=attachment %}
    {% endfor %}
  </ul>
</div>

<div class="viewlet well expanded" id="comments">
  <h2>Comments
    <a class="toggle expand" href="#">▼</a>
    <a class="toggle collapse" href="#">▲</a>
  </h2>
  {% for comment in object.comments.all %}
  {% include "snippets/comment.html" with object=comment %}
  {% endfor %}
</div>

{% include "snippets/history.html" %}

{% endblock %}
